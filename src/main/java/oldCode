///------------------------
/// ServiceClass.java
///------------------------

@Autowired
public RepoClass repo;

public Service{
}

public static User addUser(String var1, String var2, String var3, String var4) {

  User x = new User();
  x.first = var1;
  x.last = var2;
  x.email = var3;
  x.accountId = var4;
}


public static List<User> saveUsers(List<User> users) {

  for (User u : users) {
    if (repo.canAccessUser(u.accountId)) {
      repo.saveUser(u);
    }
  }
}


public static Boolean canAccessUsers(String accountId) {
  return repo.hasUserAccess(accountId);
}


/// ----------------------
/// RepoClass.java
/// ----------------------

@Autowired
ServiceClass serviceClass;

public static User saveUser(User u) {
  Session sess = HibernateUtil.getSession();

  sess.saveOrUpdate(u);

  return u;
}


public RepoClass() {
}


public static Boolean canAccessUsers(String accountId) {
  Session sess = HibernateUtil.getSession();

  UserAccess ua = sess.getUserAccess(accountId, SecurityContext.getCurrentUserId());

  if (ua != null && ua.permissions.indexOf("READ") > -1) {
    return true;
  }

  return false;
}


public List<User> getUsers(String accountId) {

  Session sess = HibernateUtil.getSession();

  return sess.query("SELECT User u where u.accountId = " + accountId, User);
}


public List<Users> saveUsers(List<Users> users) {

  Session sess = HibernateUtil.getSession();

  for (User u : users) {
    if (serviceClass.canAccessUsers(u.accountId)) {
      sess.saveOrUpdate(u);
    }
  }

  return users;
}

